{% extends "onedeal/index.html" %}
{% load humanize %}

{% block header %}
    <header>
        <img src="https://www.km-phone.com/storage/upload/basic/202103/0000000043_20210326151704_9969.png" alt=""
             class="w-100 bg-dark p-0 m-0">
{#        <div class="slider">#}
{#            <div>I am a slide.</div>#}
{#            <div>I am another slide.</div>#}
{#        </div>#}
    </header>
{% endblock %}

{# Main Content #}
{% block mainContent %}
    <div class="bgcolor-white pb-5">
        <div class="container">
            <div class="text-center py-4">
                <h1>스마트폰</h1>
            </div>
            <div class="row">
                {% for item in object_list %}
                    <div class="col-6 pb-4">
                        <div class="card">
                            <div class="row no-gutters">
                                <div class="col-sm-4">
                                    {% if item.item_img %}
                                        <img src="{{ item.item_img.url }}" alt="기기이미지"
                                             class="card-img m-4 text-center"/>
                                    {% else %}
                                        <img src="https://picsum.photos/seed/picsum/200/300" alt="noimg"
                                             class="card-img m-3 text-center">
                                    {% endif %}
                                </div>
                                <div class="col-sm-8">
                                    <div class="card-body">
                                        <h4 class="card-title mt-4">{{ item.item_name }}</h4>
                                        <h5 class="text-danger">{{ item.item_price | intcomma }} 원</h5>
                                        <ol class="bgcolor-gray breadcrumb py-1">
                                            <li class="breadcrumb-item active ms-3">LG</li>
                                            <li class="breadcrumb-item active">통신사 이동</li>
                                            <li class="breadcrumb-item active">공시지원할인</li>
                                            <li class="breadcrumb-item active">프리미어 에센셜</li>
                                        </ol>
                                        <div class="card-text small text-muted">- 원딜
                                            특별할인: {{ item.item_price | intcomma }}원
                                        </div>
                                        <div class="card-text small text-muted">-
                                            공시지원할인: {{ item.item_price | intcomma }}원
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <button class="btn btn-secondary my-2 my-sm-0" onclick="requestPay()">결제하기</button>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.8.js"></script>
    <script>
        let IMP = window.IMP;
        IMP.init("imp74307179");

        function requestPay() {
            // IMP.request_pay(param, callback) 결제창 호출
            IMP.request_pay({ // param
                pg: "nice",
                pay_method: "trans",
                merchant_uid: "ORD20180131-0000011",
                name: "노르웨이 회전 의자",
                amount: 190,
                buyer_email: "gildong@gmail.com",
                buyer_name: "홍길동",
                buyer_tel: "010-4242-4242",
                buyer_addr: "서울특별시 강남구 신사동",
                buyer_postcode: "01181"
            }, function (rsp) { // callback
                if (rsp.success) {
                    // jQuery로 HTTP 요청
                    jQuery.ajax({
                        url: "127.0.0.1:8000/onedeal/create", // 예: https://www.myservice.com/payments/complete
                        method: "POST",
                        headers: {"Content-Type": "application/json"},
                        data: {
                            imp_uid: rsp.imp_uid,
                            merchant_uid: rsp.merchant_uid
                        }
                    }).done(function (data) {
                        // 가맹점 서버 결제 API 성공시 로직
                    })
                } else {
                    alert("결제에 실패하였습니다. 에러 내용: " + rsp.error_msg);
                }
            });
        }
    </script>
{% endblock %}
